<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Runtime应用开发工具包 &mdash; J5 AI Toolchain Tool Guide  文档</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom-style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="prev" title="1.10. hb_eval_preprocess 工具" href="hb_mapper/hb_eval_preprocess.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> J5 AI Toolchain Tool Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ptq_tools.html">1. PTQ浮点定点模型转换工具包</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Runtime应用开发工具包</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hrt-model-exec">2.1. <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code> 工具</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">2.1.1. 工具简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">2.1.2. 参数说明</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-info">2.1.2.1. <code class="docutils literal notranslate"><span class="pre">model_info</span></code> 子命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="#infer">2.1.2.2. <code class="docutils literal notranslate"><span class="pre">infer</span></code> 子命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="#perf">2.1.2.3. <code class="docutils literal notranslate"><span class="pre">perf</span></code> 子命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="#latency">2.1.2.4. 多线程Latency数据说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.1.2.5. 多输入模型说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.1.2.6. 输入参数补充说明</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hrt-bin-dump">2.2. <code class="docutils literal notranslate"><span class="pre">hrt_bin_dump</span></code> 工具</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">2.2.1. 工具简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">2.2.2. 参数说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">2.2.3. 示例</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">J5 AI Toolchain Tool Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">2. </span>Runtime应用开发工具包</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="runtime">
<h1><span class="section-number">2. </span>Runtime应用开发工具包<a class="headerlink" href="#runtime" title="永久链接至标题"></a></h1>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>建议您在阅读本章内容之前先完成以下准备工作：</p>
<ol class="arabic simple">
<li><p>阅读《地平线J5 AI芯片工具链用户手册》 <a class="reference external" href="../horizon_ai_toolchain_user_guide/product_introduction.html">产品介绍</a>
章节中runtime应用开发的相关内容和
<a class="reference external" href="../horizon_ai_toolchain_user_guide/application_development.html">runtime应用开发</a> 章节内容。</p></li>
<li><p>运行 <a class="reference external" href="../ai_benchmark/index.html">《ai_benchmark使用说明》</a> 中相关示例来熟悉runtime应用开发相关示例。</p></li>
</ol>
</div>
<p>本章内容介绍地平线J5 AI芯片工具链提供的Runtime应用开发工具包中的两款工具 <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code> 和 <code class="docutils literal notranslate"><span class="pre">hrt_bin_dump</span></code>。
与前面两章内容中介绍的工具包不同的是，Runtime应用开发工具包是在开发板环境中运行的。
在使用该工具包之前，您需要执行位于J5天工开物发布物（即：horizon_j5_openexplorer）的 <code class="docutils literal notranslate"><span class="pre">ddk/package/board</span></code>
路径下的安装脚本安装工具包，命令行如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash ddk/package/board/install.sh <span class="si">${</span><span class="nv">board</span><span class="p"> IP</span><span class="si">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><code class="docutils literal notranslate"><span class="pre">${board</span> <span class="pre">IP}</span></code> 是指您获取到的J5开发板的IP地址，如：10.100.168.1。
请在执行安装脚本时将此处替换为您的开发板实际IP地址。</p>
</div>
<p>安装成功后，工作台打印信息将返回该工具包在您的J5开发板中的安装路径。
然后，分别运行 <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code> 和 <code class="docutils literal notranslate"><span class="pre">hrt_bin_dump</span></code> 命令，可验证安装成功。
命令输出如下代码块所示：</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>以下代码块所示命令行输出可能随工具版本不同有所差异，此处仅为示例。</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Usage:
hrt_model_exec [Option...] [Parameter]

[Option]                      [instruction]
---------------------------------------------------------------------------------------------------------------
-h --help                     Display this information
-v --version                  Display this version

[Option]                      [Parameter]
---------------------------------------------------------------------------------------------------------------
--model_file                  [string]: Model file paths, separate by comma, each represents one model file path.
--model_name                  [string]: Model name.
                                        When model_file has one more model and Subcommand is infer or perf,
                                        &quot;model_name&quot; must be specified!
--core_id                     [int]   : core id, 0 for any core, 1 for core 0, 2 for core 1.
--input_file                  [string]: Input file paths, separate by comma, each represents one input.
                                        The extension of files should be one of [jpg, JPG, jpeg, JPEG, png, PNG, bin, txt]
                                        bin for binary such as image data, nv12 or yuv444 etc.
                                        txt for plain data such as image info.
--enable_cls_post_process     [bool]  : flag for classfication post process, only for ptq model now.
                                        Subcommand must be infer.
--enable_dump                 [bool]  : flag for dump infer input and output. The default is false. Subcommand must be infer.
--dump_format                 [string]: output dump format, only support [bin, txt]. The default is bin.
                                        Subcommand must be infer.
--dump_precision              [int]   : Output dump precision for float32/float64 in txt file. Default is 9 decimal places.
--dump_txt_axis               [int]   : The txt file of dump is expanded according to the specified axis;
                                        the default is 4, which means there is only one data per line
                                        (for 4-dimensional data); Subcommand must be perf, dump_format must be txt
--profile_path                [string]: profile log path, set to get detail information of model execution.
--frame_count                 [int]   : frame count for run loop, default 200, valid when perf_time is 0.
                                        Subcommand must be perf.
--perf_time                   [int]   : minute, perf time for run loop, default 0.
                                        Subcommand must be perf.
--thread_num                  [int]   : thread num for run loop, thread_num range:[1,8],
                                        if thread_num &gt; 8, set thread_num = 8. Subcommand must be perf.

[Examples]
---------------------------------------------------------------------------------------------------------------
hrt_model_exec model_info          | hrt_model_exec infer               | hrt_model_exec perf
  --model_file                    |    --model_file                    |    --model_file
  --model_name                    |    --model_name                    |    --model_name
                                  |    --core_id                       |    --core_id
                                  |    --input_file                    |    --frame_count
                                  |    --enable_cls_post_process       |    --perf_time
                                  |    --enable_dump                   |    --thread_num
                                  |    --dump_format                   |    --profile_path
                                  |    --dump_txt_axis                 |
                                  |    --dump_precision                |
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span>
<span class="n">hrt_bin_dump</span> <span class="p">[</span><span class="n">Option</span><span class="o">...</span><span class="p">]</span> <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>

<span class="p">[</span><span class="n">Option</span><span class="p">]</span>            <span class="p">[</span><span class="n">instruction</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------------------------------</span>
<span class="o">-</span><span class="n">h</span> <span class="o">--</span><span class="n">help</span>           <span class="n">Display</span> <span class="n">this</span> <span class="n">information</span>
<span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">version</span>        <span class="n">Display</span> <span class="n">this</span> <span class="n">version</span>

<span class="p">[</span><span class="n">Option</span><span class="p">]</span>            <span class="p">[</span><span class="n">Parameter</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------------------------------</span>
<span class="o">--</span><span class="n">model_file</span>        <span class="p">[</span><span class="n">string</span><span class="p">]:</span> <span class="n">Model</span> <span class="n">file</span> <span class="n">path</span><span class="p">,</span> <span class="n">model</span> <span class="n">must</span> <span class="n">be</span> <span class="n">debug</span> <span class="n">model</span><span class="o">.</span>
<span class="o">--</span><span class="n">conv_mapping_file</span> <span class="p">[</span><span class="n">string</span><span class="p">]:</span> <span class="n">conv</span> <span class="n">mapping</span> <span class="n">file</span> <span class="n">path</span><span class="p">,</span> <span class="n">json</span> <span class="n">file</span><span class="o">.</span>
<span class="o">--</span><span class="n">input_file</span>        <span class="p">[</span><span class="n">string</span><span class="p">]:</span> <span class="n">Input</span> <span class="n">file</span> <span class="n">paths</span><span class="p">,</span> <span class="n">separate</span> <span class="n">by</span> <span class="n">comma</span><span class="p">,</span> <span class="n">each</span> <span class="n">represents</span> <span class="n">one</span> <span class="nb">input</span><span class="o">.</span>
                              <span class="n">The</span> <span class="n">extension</span> <span class="n">of</span> <span class="n">files</span> <span class="n">should</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span> <span class="p">[</span><span class="nb">bin</span><span class="p">,</span> <span class="n">txt</span><span class="p">]</span><span class="o">.</span>
                              <span class="nb">bin</span> <span class="k">for</span> <span class="n">binary</span> <span class="n">such</span> <span class="k">as</span> <span class="n">image</span> <span class="n">data</span><span class="p">,</span> <span class="n">nv12</span> <span class="ow">or</span> <span class="n">yuv444</span> <span class="n">etc</span><span class="o">.</span>
                              <span class="n">txt</span> <span class="k">for</span> <span class="n">plain</span> <span class="n">data</span> <span class="n">such</span> <span class="k">as</span> <span class="n">image</span> <span class="n">info</span><span class="o">.</span>
<span class="o">--</span><span class="n">conv_dump_path</span>    <span class="p">[</span><span class="n">string</span><span class="p">]:</span> <span class="n">output</span> <span class="n">path</span> <span class="n">of</span> <span class="n">conv</span> <span class="n">output</span> <span class="n">file</span>

<span class="p">[</span><span class="n">Examples</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------------------------------</span>
<span class="n">hrt_bin_dump</span>
  <span class="o">--</span><span class="n">model_file</span>
  <span class="o">--</span><span class="n">input_file</span>
  <span class="o">--</span><span class="n">conv_mapping_file</span>
  <span class="o">--</span><span class="n">conv_dump_path</span>
</pre></div>
</div>
<p>下面两个小节分别介绍两款工具的说用。</p>
<section id="hrt-model-exec">
<h2><span class="section-number">2.1. </span><code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code> 工具<a class="headerlink" href="#hrt-model-exec" title="永久链接至标题"></a></h2>
<section id="id3">
<h3><span class="section-number">2.1.1. </span>工具简介<a class="headerlink" href="#id3" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code> 是一个模型执行工具，它在开发板上评测模型的推理性能并获取模型信息。
本工具一方面可以让开发者拿到模型时实际了解模型真实性能；
另一方面也可以帮助开发者了解模型可以做到的速度极限，对于应用调优的目标极限具有指导意义。</p>
<p>如下表所示， <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code> 工具提供了模型推理 <code class="docutils literal notranslate"><span class="pre">infer</span></code>、模型性能分析 <code class="docutils literal notranslate"><span class="pre">perf</span></code> 和查看模型信息 <code class="docutils literal notranslate"><span class="pre">model_info</span></code> 三个功能。
运行 <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span></code>、 <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span> <span class="pre">-h</span></code> 或 <code class="docutils literal notranslate"><span class="pre">hrt_model_exec</span> <span class="pre">--help</span></code> 获取工具使用详情。</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 15%" />
<col style="width: 24%" />
<col style="width: 62%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>编号</strong></p></td>
<td><p><strong>子命令</strong></p></td>
<td><p><strong>说明</strong></p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">model_info</span></code></p></td>
<td><p>获取模型信息，如：模型的输入输出信息等。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">infer</span></code></p></td>
<td><p>执行模型推理，获取模型推理结果。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">perf</span></code></p></td>
<td><p>执行模型性能分析，获取性能分析结果。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id4">
<h3><span class="section-number">2.1.2. </span>参数说明<a class="headerlink" href="#id4" title="永久链接至标题"></a></h3>
<table class="docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 28%" />
<col style="width: 10%" />
<col style="width: 52%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>编号</strong></p></td>
<td><p><strong>参数</strong></p></td>
<td><p><strong>类型</strong></p></td>
<td><p><strong>说明</strong></p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">model_file</span></code></p></td>
<td><p>string</p></td>
<td><p>模型文件路径，多个路径可通过逗号分隔。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">model_name</span></code></p></td>
<td><p>string</p></td>
<td><p>指定模型中某个模型的名称。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">core_id</span></code></p></td>
<td><p>int</p></td>
<td><p>指定运行核。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">input_file</span></code></p></td>
<td><p>string</p></td>
<td><p>模型输入信息，多个可通过逗号分隔。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">enable_cls_post_process</span></code></p></td>
<td><p>bool</p></td>
<td><p>使能分类后处理。</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">enable_dump</span></code></p></td>
<td><p>bool</p></td>
<td><p>使能dump模型输入和输出。</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dump_format</span></code></p></td>
<td><p>string</p></td>
<td><p>dump模型输入和输出的格式。</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dump_precision</span></code></p></td>
<td><p>int</p></td>
<td><p>控制txt格式输出float型数据的小数点位数。</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dump_txt_axis</span></code></p></td>
<td><p>int</p></td>
<td><p>控制txt格式输入输出的换行规则。</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">profile_path</span></code></p></td>
<td><p>string</p></td>
<td><p>模型性能/调度性能统计数据的保存路径。</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">frame_count</span></code></p></td>
<td><p>int</p></td>
<td><p>执行模型运行帧数。</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">perf_time</span></code></p></td>
<td><p>int</p></td>
<td><p>执行模型运行时间。</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">thread_num</span></code></p></td>
<td><p>int</p></td>
<td><p>指定程序运行线程数。</p></td>
</tr>
</tbody>
</table>
<section id="model-info">
<h4><span class="section-number">2.1.2.1. </span><code class="docutils literal notranslate"><span class="pre">model_info</span></code> 子命令<a class="headerlink" href="#model-info" title="永久链接至标题"></a></h4>
<p>该参数用于获取模型信息，模型支持范围：ptq和qat模型。该参数与 <code class="docutils literal notranslate"><span class="pre">model_file</span></code> 一起使用，用于获取模型的详细信息，
信息包括：模型输入输出信息 <code class="docutils literal notranslate"><span class="pre">hbDNNTensorProperties</span></code> 以及模型的分段信息 <code class="docutils literal notranslate"><span class="pre">stage</span></code>, 分段信息是指：一张图片可以分多个阶段进行推理，stage信息为[x1, y1, x2, y2]，分别为图片推理的左上角和右下角坐标，目前地平线J5的bayes架构支持这类分段模型的推理，xj3上模型均为1个stage。</p>
<p>不指定 <code class="docutils literal notranslate"><span class="pre">model_name</span></code> 输出模型中所有模型信息，指定 <code class="docutils literal notranslate"><span class="pre">model_name</span></code> 则只输出对应模型的信息。
请参考以下示例。</p>
<p><strong>使用示例</strong></p>
<ol class="arabic simple">
<li><p>单模型</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">model_info</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>多模型（输出所有模型信息）</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">model_info</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>多模型--pack模型（输出指定模型信息）</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">model_info</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">model_name</span><span class="o">=</span><span class="n">xx</span>
</pre></div>
</div>
<img alt="_images/model_info.png" src="_images/model_info.png" />
</div></blockquote>
</section>
<section id="infer">
<h4><span class="section-number">2.1.2.2. </span><code class="docutils literal notranslate"><span class="pre">infer</span></code> 子命令<a class="headerlink" href="#infer" title="永久链接至标题"></a></h4>
<p>该参数用于模型推理。
用户需自定义输入图片，推理运行一帧。
该参数需要与 <code class="docutils literal notranslate"><span class="pre">input_file</span></code> 一起使用，指定输入图片路径。
工具根据模型信息resize图片，整理模型输入信息。
程序将以单线程运行单帧数据，并输出模型运行的时间。
请参考以下示例：</p>
<p><strong>使用示例</strong></p>
<ol class="arabic simple">
<li><p>单模型</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">infer</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">input_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>多模型</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">infer</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">model_name</span><span class="o">=</span><span class="n">xx</span> <span class="o">--</span><span class="n">input_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">jpg</span>
</pre></div>
</div>
<img alt="_images/infer.png" src="_images/infer.png" />
</div></blockquote>
<p><strong>可选参数</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>参数</p></td>
<td><p>说明</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">core_id</span></code></p></td>
<td><p>指定模型推理核id。 <code class="docutils literal notranslate"><span class="pre">0</span></code>：任意核； <code class="docutils literal notranslate"><span class="pre">1</span></code>：core0； <code class="docutils literal notranslate"><span class="pre">2</span></code>：core1。默认为 <code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">enable_cls_post_process</span></code></p></td>
<td><p>使能分类后处理，目前只支持ptq分类模型，默认为 <code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">enable_dump</span></code></p></td>
<td><p>dump模型输出数据，默认 <code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dump_format</span></code></p></td>
<td><p>dump模型输出文件的类型，可选参数为 <code class="docutils literal notranslate"><span class="pre">bin</span></code> 或 <code class="docutils literal notranslate"><span class="pre">txt</span></code>，默认为 <code class="docutils literal notranslate"><span class="pre">bin</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dump_txt_axis</span></code></p></td>
<td><p>dump模型txt格式输出的换行规则；若输出维度为n，则参数范围[0, n]，默认为 <code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="perf">
<h4><span class="section-number">2.1.2.3. </span><code class="docutils literal notranslate"><span class="pre">perf</span></code> 子命令<a class="headerlink" href="#perf" title="永久链接至标题"></a></h4>
<p>该参数用于测试模型性能。
该模式下，用户无需输入数据，程序根据模型信息自动构造输入tensor，tensor数据为随机数。
程序默认单线程运行200帧数据，当指定 <code class="docutils literal notranslate"><span class="pre">perf_time</span></code> 参数时， <code class="docutils literal notranslate"><span class="pre">frame_count</span></code> 参数失效，程序会执行指定时间后退出。
输出模型运行的latency以及帧率信息。程序每200帧打印一次性能信息，包括：
latency的最大、最小和平均值。如不足200帧，则程序运行结束后打印一次性能信息。</p>
<p>程序最后输出running相关数据，包括：程序线程数、帧数、模型推理总时间、模型推理平均latency以及帧率信息。
请参考以下示例：</p>
<p><strong>使用示例</strong></p>
<ol class="arabic simple">
<li><p>单模型</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">perf</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>多模型</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">perf</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span><span class="p">,</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">model_name</span><span class="o">=</span><span class="n">xx</span>
</pre></div>
</div>
<img alt="_images/perf.png" src="_images/perf.png" />
</div></blockquote>
<p><strong>可选参数</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">core_id</span></code></p></td>
<td><p>指定推理核id。 <code class="docutils literal notranslate"><span class="pre">0</span></code>：任意核， <code class="docutils literal notranslate"><span class="pre">1</span></code>：core0， <code class="docutils literal notranslate"><span class="pre">2</span></code>：core1；默认 <code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">frame_count</span></code></p></td>
<td><p>设置 <code class="docutils literal notranslate"><span class="pre">perf</span></code> 运行帧数，当 <code class="docutils literal notranslate"><span class="pre">perf_time</span></code> 为 <code class="docutils literal notranslate"><span class="pre">0</span></code> 时生效，默认值 <code class="docutils literal notranslate"><span class="pre">200</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">perf_time</span></code></p></td>
<td><p>设置 <code class="docutils literal notranslate"><span class="pre">perf</span></code> 运行时间，单位：分钟，默认值 <code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">thread_num</span></code></p></td>
<td><p>设置程序运行线程数，范围[1, 8], 默认值 <code class="docutils literal notranslate"><span class="pre">1</span></code>, 设置大于8时按照8个线程处理</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">profile_path</span></code></p></td>
<td><p>统计工具日志产生路径，运行产生profiler.log，分析op耗时和调度耗时</p></td>
</tr>
</tbody>
</table>
</section>
<section id="latency">
<h4><span class="section-number">2.1.2.4. </span>多线程Latency数据说明<a class="headerlink" href="#latency" title="永久链接至标题"></a></h4>
<p>多线程的目的是为了充分利用BPU资源，多线程共同处理 <code class="docutils literal notranslate"><span class="pre">frame_count</span></code> 帧数据或执行 <code class="docutils literal notranslate"><span class="pre">perf_time</span></code> 时间，直至数据处理完成/执行时间结束程序结束。
在多线程 <code class="docutils literal notranslate"><span class="pre">perf</span></code> 过程中可以执行以下命令，实时获取BPU资源占用率情况。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hrut_somstatus -n <span class="m">10000</span> –d <span class="m">1</span>
</pre></div>
</div>
<p>输出如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@j5dvb:/# hrut_somstatus -n <span class="m">10000</span> –d <span class="nv">1</span>
<span class="o">=====================</span><span class="nv">1</span><span class="o">=====================</span>
temperature--&gt;
  ddr_cv_cam-thermal : <span class="m">31</span>.1 <span class="o">(</span>C<span class="o">)</span>
  soc-thermal : <span class="m">30</span>.8 <span class="o">(</span>C<span class="o">)</span>
  bpu0_r-thermal : <span class="m">30</span>.1 <span class="o">(</span>C<span class="o">)</span>
  ddr0_sram : <span class="m">30</span>.9 <span class="o">(</span>C<span class="o">)</span>
  bpu0_b_top : <span class="m">29</span>.4 <span class="o">(</span>C<span class="o">)</span>
  bpu0_video : <span class="m">30</span>.2 <span class="o">(</span>C<span class="o">)</span>
  ddr0_video : <span class="m">30</span>.9 <span class="o">(</span>C<span class="o">)</span>
  peri     : <span class="m">30</span>.7 <span class="o">(</span>C<span class="o">)</span>
  bpu1_cpu-thermal : <span class="m">30</span>.1 <span class="o">(</span>C<span class="o">)</span>
  bpu1_sram : <span class="m">30</span>.5 <span class="o">(</span>C<span class="o">)</span>
  bpu1_top : <span class="m">29</span>.8 <span class="o">(</span>C<span class="o">)</span>
  bpu1_left : <span class="m">30</span>.1 <span class="o">(</span>C<span class="o">)</span>
  bpu0_cam_cv : <span class="m">30</span>.2 <span class="o">(</span>C<span class="o">)</span>
  ddr1_cam : <span class="m">30</span>.6 <span class="o">(</span>C<span class="o">)</span>
  cpu-thermal : <span class="m">30</span>.7 <span class="o">(</span>C<span class="o">)</span>
  cpu_t-thermal : <span class="m">30</span>.4 <span class="o">(</span>C<span class="o">)</span>
cpu frequency--&gt;
        min   cur     max
  cpu0: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu1: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu2: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu3: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu4: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu5: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu6: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
  cpu7: <span class="m">24000</span> <span class="m">1200000</span> <span class="m">1200000</span>
bpu status information----&gt;
      min     cur             max             ratio
  bpu0: <span class="m">200000000</span>     <span class="m">1200000000</span>      <span class="m">1200000000</span>      <span class="m">0</span>
  bpu1: <span class="m">200000000</span>     <span class="m">1200000000</span>      <span class="m">1200000000</span>      <span class="m">0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">perf</span></code> 模式下，单线程的latency时间表示模型的实测上板性能，
而多线程的latency数据表示的是每个线程的模型单帧处理时间，
相对于单线程的时间要长，但是多线程的总体处理时间减少，其帧率是提升的。</p>
</div>
</section>
<section id="id5">
<h4><span class="section-number">2.1.2.5. </span>多输入模型说明<a class="headerlink" href="#id5" title="永久链接至标题"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">infer</span></code> 子命令的推理功能支持多输入模型的推理。
输入数据支持图片、二进制文件以及文本文件，输入数据用逗号隔开。
模型的输入信息可以通过 <code class="docutils literal notranslate"><span class="pre">model_info</span></code> 进行查看。</p>
<p><strong>使用示例</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">infer</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">input_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">jpg</span><span class="p">,</span><span class="nb">input</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section id="id6">
<h4><span class="section-number">2.1.2.6. </span>输入参数补充说明<a class="headerlink" href="#id6" title="永久链接至标题"></a></h4>
<p><strong>重复输入</strong></p>
<p>若重复指定参数输入，则会发生参数覆盖。
例如，获取模型信息时，如果重复指定了两个模型文件，则会取后面指定的参数输入 <code class="docutils literal notranslate"><span class="pre">yyy.bin</span></code>。
参见以下代码块示例：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">model_info</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">yyy</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<p>若重复指定输入时，未加命令行参 <code class="docutils literal notranslate"><span class="pre">--model_file</span></code>，则会取命令行参数后面的值，未加参数的不识别。
例如，下例会忽略 <code class="docutils literal notranslate"><span class="pre">yyy.bin</span></code>，参数实际取值为 <code class="docutils literal notranslate"><span class="pre">xxx.bin</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrt_model_exec</span> <span class="n">model_info</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">bin</span> <span class="n">yyy</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<p>其他命令行参数的重复输入情况以此类推。</p>
<p><strong>其他参数补充说明</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">input_file</span></code> 参数指定图片类型的输入，其文件名后缀必须为 <code class="docutils literal notranslate"><span class="pre">bin</span></code> / <code class="docutils literal notranslate"><span class="pre">JPG</span></code> / <code class="docutils literal notranslate"><span class="pre">JPEG</span></code> / <code class="docutils literal notranslate"><span class="pre">jpg</span></code> / <code class="docutils literal notranslate"><span class="pre">jpeg</span></code> 中的一种，
feature输入后缀名必须为 <code class="docutils literal notranslate"><span class="pre">bin</span></code> / <code class="docutils literal notranslate"><span class="pre">txt</span></code> 中的一种。
每个输入之间需要用英文字符的逗号隔开 <code class="docutils literal notranslate"><span class="pre">,</span></code>，如： <code class="docutils literal notranslate"><span class="pre">xxx.jpg,input.txt</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">profile_path</span></code> 参数用于指定profile日志文件生成的目录。
该参数通过设置环境变量 <code class="docutils literal notranslate"><span class="pre">HB_DNN_PROFILER_LOG_PATH</span></code> 查看模型运行过程中OP以及任务调度耗时。
一般设置 <code class="docutils literal notranslate"><span class="pre">--profile_path=&quot;.&quot;</span></code> 即可，代表在当前目录下生成日志文件，生成的日志文件为profiler.log。</p>
<p><code class="docutils literal notranslate"><span class="pre">enable_cls_post_process</span></code> 参数用于使能分类后处理。
子命令为 <code class="docutils literal notranslate"><span class="pre">infer</span></code> 时配合使用，目前只支持ptq分类模型（即：***.bin）的后处理，如设置为 <code class="docutils literal notranslate"><span class="pre">true</span></code> 则将会打印分类结果。
参见下图：</p>
<img alt="_images/enable_cls_post_process.png" src="_images/enable_cls_post_process.png" />
</section>
</section>
</section>
<section id="hrt-bin-dump">
<h2><span class="section-number">2.2. </span><code class="docutils literal notranslate"><span class="pre">hrt_bin_dump</span></code> 工具<a class="headerlink" href="#hrt-bin-dump" title="永久链接至标题"></a></h2>
<section id="id7">
<h3><span class="section-number">2.2.1. </span>工具简介<a class="headerlink" href="#id7" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">hrt_bin_dump</span></code> 是 ptq debug模型（即：***.bin）的layer dump工具，工具的输出文件为二进制文件。</p>
</section>
<section id="id8">
<h3><span class="section-number">2.2.2. </span>参数说明<a class="headerlink" href="#id8" title="永久链接至标题"></a></h3>
<table class="docutils align-center">
<colgroup>
<col style="width: 3%" />
<col style="width: 13%" />
<col style="width: 5%" />
<col style="width: 13%" />
<col style="width: 66%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>编号</p></td>
<td><p>参数</p></td>
<td><p>类型</p></td>
<td><p>描述</p></td>
<td><p>说明</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">model_file</span></code></p></td>
<td><p>string</p></td>
<td><p>模型文件路径。</p></td>
<td><p>必须为debug model。即模型的编译参数 <code class="docutils literal notranslate"><span class="pre">layer_out_dump</span></code> 需要设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，指定模型转换过程中输出各层的中间结果。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">input_file</span></code></p></td>
<td><p>string</p></td>
<td><p>输入文件路径。</p></td>
<td><p>模型的输入文件，支持 <code class="docutils literal notranslate"><span class="pre">hbDNNDataType</span></code> 所有类型的输入；
IMG类型文件需为二进制文件（后缀必须为.bin），二进制文件的大小应与模型的输入信息相匹配，
如：YUV444文件大小为 <span class="math notranslate nohighlight">\(height * width * 3\)</span>；
TENSOR类型文件需为二进制文件或文本文件（后缀必须为.bin/.txt），二进制文件的大小应与模型的输入信息相匹配，
文本文件的大小必须大于模型要求的输入大小，多余的数据会被丢弃；每个输入之间通过逗号分隔，如：模型有两个输入，
则： <code class="docutils literal notranslate"><span class="pre">--input_file=kite.bin,input.txt</span></code>。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">conv_mapping_file</span></code></p></td>
<td><p>string</p></td>
<td><p>模型卷积层配置文件。</p></td>
<td><dl class="simple">
<dt>模型layer配置文件，配置文件中标明了模型各层信息，在模型编译过程中生成。文件名称一般为：</dt><dd><p><code class="docutils literal notranslate"><span class="pre">model_name_quantized_model_conv_output_map.json</span></code>。</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">conv_dump_path</span></code></p></td>
<td><p>string</p></td>
<td><p>工具输出路径。</p></td>
<td><p>工具的输出路径，该路径应为合法路径。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id9">
<h3><span class="section-number">2.2.3. </span>示例<a class="headerlink" href="#id9" title="永久链接至标题"></a></h3>
<p>以MobileNetv1的debug模型为例，创建outputs文件夹，执行以下命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">hrt_bin_dump</span> <span class="o">--</span><span class="n">model_file</span><span class="o">=./</span><span class="n">mobilenetv1_hybrid_horizonrt</span><span class="o">.</span><span class="n">bin</span> \
<span class="o">--</span><span class="n">conv_mapping_file</span><span class="o">=./</span><span class="n">mobilenetv1_quantized_model_conv_output_map</span><span class="o">.</span><span class="n">json</span> \
<span class="o">--</span><span class="n">conv_dump_path</span><span class="o">=./</span><span class="n">outputs</span> \
<span class="o">--</span><span class="n">input_file</span><span class="o">=./</span><span class="n">zebra_cls</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<p>运行日志参见以下截图：</p>
<img alt="_images/run_log.png" src="_images/run_log.png" />
<p>在 <code class="docutils literal notranslate"><span class="pre">outputs/</span></code> 路径下可以查看输出，参见以下截图：</p>
<img alt="_images/output.png" src="_images/output.png" />
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hb_mapper/hb_eval_preprocess.html" class="btn btn-neutral float-left" title="1.10. hb_eval_preprocess 工具" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, Horizon Robotics.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>